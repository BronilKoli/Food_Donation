{% extends "base.html" %}

{% block title %}Available Donations{% endblock %}

{% block content %}
<div class="container dashboard">
    <div class="dashboard-header mb-3">
        <h2>Available Donations</h2>
    </div>
    
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div class="d-flex gap-2">
            <select class="form-select" id="category-filter">
                <option value="">All Categories</option>
                <option value="perishable">Perishable Food</option>
                <option value="non_perishable">Non-Perishable Food</option>
                <option value="prepared_meals">Prepared Meals</option>
                <option value="groceries">Groceries</option>
                <option value="other">Other</option>
            </select>
            <button class="btn btn-secondary" onclick="applyFilters()">Filter</button>
        </div>
        <div class="search-box">
            <input type="text" placeholder="Search donations..." id="donation-search" class="form-control">
        </div>
    </div>

    {% if donations %}
        <div class="donation-cards">
            {% for donation in donations %}
            <div class="donation-card">
                <div class="donation-header">
                    <h3>{{ donation.food_name }}</h3>
                    <span class="badge category-{{ donation.category }}">{{ donation.category }}</span>
                </div>
                <div class="donation-details">
                    <p><strong>Quantity:</strong> {{ donation.quantity }} {{ donation.unit }}</p>
                    <p><strong>Donor:</strong> {{ donation.donor_name }}</p>
                    <p><strong>Location:</strong> {{ donation.location }}</p>
                    {% if donation.expiry_date %}
                    <p><strong>Expires:</strong> {{ donation.expiry_date.strftime('%Y-%m-%d') }}</p>
                    {% endif %}
                    <p><strong>Description:</strong> {{ donation.description }}</p>
                </div>
                <div class="donation-actions d-flex gap-2">
                    {% if 'organization' in permissions %}
                    <form action="{{ url_for('request_food', donation_id=donation.id) }}" method="POST">
                        <button type="submit" class="btn btn-primary">Request</button>
                    </form>
                    {% endif %}
                    <a href="#" class="btn btn-info" onclick="viewDetails('{{ donation.id }}')">View Details</a>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-box-open"></i>
            </div>
            <h3>No available donations</h3>
            <p>There are currently no available donations. Please check back later.</p>
        </div>
    {% endif %}
</div>

{% block scripts %}
<script>
    function viewDetails(donationId) {
        // Redirect to donation details page or show modal
        window.location.href = `/donation/${donationId}`;
    }
    
    function applyFilters() {
        const category = document.getElementById('category-filter').value;
        const searchQuery = document.getElementById('donation-search').value;
        
        window.location.href = `/view-donations?category=${category}&search=${searchQuery}`;
    }
    
    // Add search functionality
    document.getElementById('donation-search').addEventListener('keyup', function(e) {
        if (e.key === 'Enter') {
            applyFilters();
        }
    });
</script>
{% endblock %}
{% endblock %}