{% extends "base.html" %}

{% block title %}User Management{% endblock %}

{% block content %}
<div class="container dashboard">
    <div class="dashboard-header mb-3">
        <h2>User Management</h2>
        <button class="btn btn-primary" onclick="addUser()">Add New User</button>
    </div>
    
    <div class="filters d-flex justify-content-between align-items-center mb-3">
        <div class="d-flex gap-2">
            <select class="form-select" id="role-filter">
                <option value="">All Roles</option>
                <option value="donor">Donors</option>
                <option value="organization">Organizations</option>
                <option value="volunteer">Volunteers</option>
                <option value="admin">Admins</option>
            </select>
            <button class="btn btn-secondary" onclick="applyFilters()">Filter</button>
        </div>
        <div class="search-box">
            <input type="text" placeholder="Search users..." id="user-search" class="form-control">
        </div>
    </div>
    
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Created</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.name }}</td>
                    <td>{{ user.email }}</td>
                    <td><span class="badge role-{{ user.role }}">{{ user.role }}</span></td>
                    <td>{{ user.created_at.strftime('%Y-%m-%d') if user.created_at else "N/A" }}</td>
                    <td>
                        {% if user.is_active %}
                            <span class="badge status active">Active</span>
                        {% else %}
                            <span class="badge status inactive">Inactive</span>
                        {% endif %}
                    </td>
                    <td class="d-flex gap-2">
                        <button onclick="editUser('{{ user.id }}')" class="btn btn-secondary">Edit</button>
                        <button onclick="deleteUser('{{ user.id }}')" class="btn btn-danger">Delete</button>
                        {% if not user.is_active %}
                            <button onclick="activateUser('{{ user.id }}')" class="btn btn-success">Activate</button>
                        {% else %}
                            <button onclick="deactivateUser('{{ user.id }}')" class="btn btn-warning">Deactivate</button>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% block scripts %}
<script>
    function addUser() {
        // Redirect to user creation page
        window.location.href = "{{ url_for('signup') }}";
    }
    
    function editUser(userId) {
        // Implement user editing (using modal or redirect)
        window.location.href = `/edit-user/${userId}`;
    }
    
    function deleteUser(userId) {
        if (confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
            window.location.href = `/delete-user/${userId}`;
        }
    }
    
    function activateUser(userId) {
        window.location.href = `/activate-user/${userId}`;
    }
    
    function deactivateUser(userId) {
        window.location.href = `/deactivate-user/${userId}`;
    }
    
    function applyFilters() {
        const role = document.getElementById('role-filter').value;
        const searchQuery = document.getElementById('user-search').value;
        
        window.location.href = `/manage-users?role=${role}&search=${searchQuery}`;
    }
</script>
{% endblock %}
{% endblock %}